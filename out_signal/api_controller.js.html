<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Source: api/controller.js</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Source: api/controller.js</h1>

    



    
    <section>
        <article>
            <pre class="prettyprint source linenums"><code>
let Signal = require('../models/signal.model');

/**
 * Controlleur du chemin '/'
 * @param res - le resultat qui est un tableau contients tous les signaux
 */
exports.getAll = function(req, res) {
    Signal.find(function(err, signal) {
        if (err) {
            console.log(err);
        } else {
            res.json(signal);
        }
    });
}
/**
 * Controlleur du chemin '/:id'
 * @param req - la requete contenant l'id de l'étudiant qu'on cherche
 * @param res - le resultat contenant l'objet étudiant en question 
 * @description recuperer l'objet du ID données si il existe dans la bdd.
 */

exports.getById = function(req, res) {
    let id = req.params.id;
    Signal.findById(id, function(err,signal ) {
        res.json(signal);
    });
}

exports.update = function(req, res) {
    Signal.findById(req.params.id, function(err, signal) {
        if (!signal)
            res.status(404).send("data is not found");
        else
            signal.student_last_name= req.body.student_last_name,
            signal.student_first_name= req.body.student_first_name,
            signal.signal_object= req.body.signal_object,
            signal.signal_problem= req.body.signal_problem,
            

            signal.save().then(signal => {
                res.json('Signal updated!');
            })
            .catch(err => {
                res.status(400).send("Update not possible");
            });
    });
}
/**
 * Controlleur du chemin '/add'
 * @param req - la requete contenant l'objet signal à insérer
 * @param res - le resultat contenant les informations nécessaire pour ajout d'un utilisateur relié à le signal
 * @description suivant à une demande du signal faite par l'utilisateur on récupere les details liée a ce signal 
 * on les mets dans la bdd afin de sauvegarder toute activité faite par un étudiant, comme on va lancer le service mailer
 * qui va envoyer ce mail a l'administrateur afin de signaler l'existance d'un probleme. 
 */

exports.signaler = function(req, res) {
    
            let signal = new Signal(req.body);
            signal.save()
                .then(signal => {
                    res.status(200).json(signal);
                })
                .catch(err => {
                    res.status(400).send('adding new student failed');
                });
                var nodemailer = require('nodemailer');
   /**
    * @var transporter -initialiser le compte utiliser dans le mailer pour envoyer un signal
    */             
var transporter = nodemailer.createTransport(
    {
        service: 'gmail', 
        auth:{
            user: 'esia17615@gmail.com',
            pass: 'esiesi123654789'

        }
    }
);
/**
 * @var mailOptions -initialiser le contenant du mail avec la definition de sa structure + lerecepteur
 */

var mailOptions = {
    from: 'esia17615@gmail.com',
    to: 'kansabsamah@gmail.com',
    subject: signal.signal_object,
    text: 'par:   ' + signal.student_first_name + ' '+ signal.student_last_name + '  ==>  ' + signal.signal_problem
};
/**
 * @description lancer l'envoie du mail
 */
transporter.sendMail(mailOptions, function(error , info){
    if (error){
        console.log(error);
    } else {
        console.log('Email sent:'+ info.response);
    }

});

        
}

</code></pre>
        </article>
    </section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Global</h3><ul><li><a href="global.html#getAll">getAll</a></li><li><a href="global.html#getById">getById</a></li><li><a href="global.html#mailOptions">mailOptions</a></li><li><a href="global.html#Signal">Signal</a></li><li><a href="global.html#signaler">signaler</a></li><li><a href="global.html#transporter">transporter</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Fri Jan 03 2020 13:16:32 GMT+0100 (GMT+01:00)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>
